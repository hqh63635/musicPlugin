#user  nobody;
worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile      on;
    keepalive_timeout 65;

    server {
        listen 9527;
        server_name localhost;

        # ==========================
        # === 前端静态资源配置  ===
        # ==========================
        root html/dist;
        index index.html;

        # SPA 支持
        location / {
            try_files $uri $uri/ /index.html;
        }

        # ==========================
        # === 接口代理配置      ===
        # ==========================

        # 1. /api → https://c.y.qq.com
        location /api/ {
            proxy_pass https://c.y.qq.com/;
            proxy_ssl_verify off;
            proxy_ssl_server_name on;

            proxy_set_header Host c.y.qq.com;
            proxy_set_header Referer https://y.qq.com/;
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)";
            proxy_set_header X-Requested-With "XMLHttpRequest";
            proxy_set_header X-Real-IP $remote_addr;

            proxy_redirect off;
        }

        # 2. /musicu → https://u.y.qq.com/cgi-bin/musicu.fcg
        location /musicu {
            # 直接代理到接口完整路径，避免 rewrite 触发 301/302
            proxy_pass https://u.y.qq.com/cgi-bin/musicu.fcg;

            proxy_ssl_verify off;
            proxy_ssl_server_name on;

            proxy_set_header Host u.y.qq.com;
            proxy_set_header Referer https://y.qq.com/;
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)";
            proxy_set_header X-Requested-With "XMLHttpRequest";
            proxy_set_header X-Real-IP $remote_addr;

            proxy_redirect off;
        }

        # 3. /qqapi → https://u.y.qq.com
        location /qqapi/ {
            proxy_pass https://u.y.qq.com/;
            proxy_ssl_verify off;
            proxy_ssl_server_name on;

            proxy_set_header Host u.y.qq.com;
            proxy_set_header Referer https://y.qq.com/;
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)";
            proxy_set_header X-Requested-With "XMLHttpRequest";
            proxy_set_header X-Real-IP $remote_addr;

            proxy_redirect off;
        }

        # 4. /qqmusic → https://u6.y.qq.com
        location /qqmusic/ {
            proxy_pass https://u6.y.qq.com/;
            proxy_ssl_verify off;
            proxy_ssl_server_name on;

            proxy_set_header Host u6.y.qq.com;
            proxy_set_header Referer https://y.qq.com/;
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)";
            proxy_set_header X-Requested-With "XMLHttpRequest";
            proxy_set_header X-Real-IP $remote_addr;

            proxy_redirect off;
        }

        # 5. /haitang → http://musicapi.haitangw.net
        location /haitang/ {
            proxy_pass http://musicapi.haitangw.net/;
            proxy_set_header Host musicapi.haitangw.net;
            proxy_set_header X-Real-IP $remote_addr;

            proxy_redirect off;
        }

        location /qzone {
            proxy_pass http://i.y.qq.com/;
            proxy_set_header Host i.y.qq.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Referer http://i.y.qq.com/;
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)";
            proxy_set_header X-Requested-With "XMLHttpRequest";

            proxy_redirect off;
        }

        # ==========================
        # === gzip 可选配置     ===
        # ==========================
        gzip on;
        gzip_types text/plain application/javascript application/json text/css;
    }
}